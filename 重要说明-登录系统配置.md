# 🔐 登录系统配置说明

## ⚠️ 重要提示

登录系统已成功从激活码方式切换为账号密码登录方式。在使用前，**必须**配置正确的API服务器地址。

---

## 📝 必须修改的配置

### 1. 修改API服务器地址

打开文件：`modules/common/login_manager.py`

找到第21行，将：
```python
API_BASE_URL = "https://your-domain.com/api/v1"
```

修改为您的实际服务器地址，例如：
```python
API_BASE_URL = "https://api.example.com/api/v1"
```

---

## 🔧 系统变更说明

### 已删除的文件
- ❌ `modules/common/activation.py` - 旧的激活码管理器
- ❌ `ui/components/activation_dialog.py` - 旧的激活对话框

### 新增的文件
- ✅ `modules/common/login_manager.py` - 新的登录管理器
- ✅ `ui/components/login_dialog.py` - 新的登录对话框

### 修改的文件
- 📝 `src/main_window.py` - 更新登录检查逻辑
- 📝 `config/app_config.py` - 添加API配置
- 📝 `requirements.txt` - 添加requests库依赖
- 📝 `README.md` - 更新项目说明
- 📝 `docs/安装和使用指南.md` - 更新用户指南
- 📝 `docs/开发者文档.md` - 更新开发文档

---

## 🚀 使用流程

### 首次使用
1. 用户启动软件
2. 系统检测未登录
3. 显示登录对话框
4. 用户输入手机号和密码
5. 系统调用服务器API验证
6. 登录成功后保存Token到本地
7. 进入主界面

### 再次使用
1. 用户启动软件
2. 系统检测到本地保存的Token
3. 验证Token是否过期
4. 如未过期，直接进入主界面
5. 如已过期，显示登录对话框

---

## 🔐 登录系统特性

### 设备ID管理
- ✅ 自动生成包含"tool"的设备ID
- ✅ 符合API文档规范：`tool-{系统}-{机器名}-{UUID}`
- ✅ 持久化保存，避免重复生成

### Token管理
- ✅ 本地保存Access Token和Refresh Token
- ✅ 自动检测Token过期
- ✅ 支持Token刷新（需要实现刷新接口）

### 安全特性
- ✅ 配置文件自动隐藏（Windows）
- ✅ 多位置备份配置文件
- ✅ 权限问题智能处理

---

## 📋 配置文件位置

系统会按优先级尝试以下位置保存配置：

### Windows
1. `%APPDATA%\VideoProcessingTools\.login_config` （推荐）
2. `Documents\VideoProcessingTools\.login_config`
3. `%TEMP%\VideoProcessingTools\.login_config`

### Linux/Mac
1. `~/.VideoProcessingTools/.login_config` （推荐）
2. `~/Documents/VideoProcessingTools/.login_config`
3. `/tmp/VideoProcessingTools/.login_config`

---

## 🛠️ 依赖安装

在使用前，请确保安装了所有依赖：

```bash
pip install -r requirements.txt
```

新增依赖：
- `requests>=2.28.0` - 用于HTTP请求

---

## ✅ 功能保留确认

原有的两个核心功能已完整保留：

### 1. 音频提取功能 ✅
- 从视频文件中提取高质量音频
- 支持批量处理
- 多线程加速
- 智能音频优化

### 2. 字幕重命名功能 ✅
- 智能匹配视频和字幕文件
- 支持多种命名格式
- 批量重命名
- 安全撤销

---

## 🔄 API接口说明

根据提供的API文档，登录接口规范：

### 请求地址
```
POST {API_BASE_URL}/auth/login
```

### 请求参数
```json
{
  "phone": "13800138888",
  "password": "your_password",
  "client_version": "ToolKit-v2.0.0",
  "system_info": "Windows 10",
  "device_id": "tool-windows-xxx-xxx"
}
```

### 成功响应
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_in": 3600,
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user_info": {
      "id": 123,
      "phone": "13800138888",
      "nickname": "用户昵称",
      "role": "client_default"
    }
  }
}
```

---

## ⚠️ 注意事项

1. **必须配置API服务器地址**，否则无法登录
2. **确保网络连接正常**，登录需要访问服务器
3. **device_id必须包含"tool"字样**，已自动处理
4. **密码最少6位**，手机号必须11位
5. **Token过期后需重新登录**，默认1小时有效期

---

## 📞 技术支持

如有问题，请检查：
1. API服务器地址是否正确
2. 网络连接是否正常
3. 手机号和密码是否正确
4. 服务器是否正常运行

---

**修改完毕，请手动测试。**

